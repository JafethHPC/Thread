<div class="conversation-container bg-white">
  <!-- Header -->
  <div
    class="header-section flex-shrink-0 flex items-center justify-between p-4 border-b border-gray-200"
  >
    <h2 class="text-lg font-semibold">Meeting with Sarah</h2>
    <div class="flex items-center space-x-3">
      <button
        class="p-1.5 text-gray-500 hover:text-black hover:bg-gray-100 rounded-md"
      >
        <!-- Voice icon -->
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"
          ></path>
        </svg>
      </button>
      <button
        class="p-1.5 text-gray-500 hover:text-black hover:bg-gray-100 rounded-md"
      >
        <!-- Share icon -->
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.368a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"
          ></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Chat Area (Flexible middle section) -->
  <div class="chat-area flex-1 p-6 overflow-y-auto">
    <!-- Login Prompt -->
    <div
      *ngIf="!(isAuthenticated$ | async)"
      class="h-full w-full flex items-center justify-center"
    >
      <button
        (click)="loginWithGoogle()"
        class="bg-black text-white font-semibold py-3 px-6 rounded-lg hover:bg-gray-800"
      >
        Login with Google to get started
      </button>
    </div>

    <ng-container *ngIf="isAuthenticated$ | async">
      <!-- A single message group containing user prompt and AI response -->
      <div *ngFor="let message of messages" class="space-y-4">
        <!-- User's Message (right-aligned) -->
        <div class="flex justify-end">
          <div class="bg-black text-white p-3 rounded-lg max-w-lg">
            <p>{{ message.user }}</p>
          </div>
        </div>

        <!-- AI's Response (left-aligned) -->
        <div *ngIf="message.ai || isLoading" class="flex justify-start">
          <div class="bg-gray-100 text-black p-3 rounded-lg max-w-lg">
            <!-- Show typing indicator or AI message -->
            <p *ngIf="isLoading && !message.ai" class="typing-indicator">
              <span></span><span></span><span></span>
            </p>
            <p *ngIf="message.ai">{{ message.ai }}</p>
          </div>
        </div>
      </div>

      <!-- Typing Indicator for the very first message -->
      <div
        *ngIf="isLoading && messages.length === 0"
        class="flex justify-start"
      >
        <div class="bg-gray-100 text-black p-3 rounded-lg max-w-lg">
          <p class="typing-indicator">
            <span></span><span></span><span></span>
          </p>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Footer Input (pushed to bottom) -->
  <div class="input-footer p-4 bg-white border-t border-gray-200">
    <div class="input-container relative w-full">
      <input
        type="text"
        placeholder="Ask Thread anything..."
        class="w-full bg-gray-100 border-none rounded-lg py-3 pl-12 pr-20 focus:ring-2 focus:ring-black"
        [(ngModel)]="newMessage"
        (keyup.enter)="sendMessage()"
        [disabled]="isLoading || !(isAuthenticated$ | async)"
      />
      <button
        class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 hover:text-black"
        [disabled]="isLoading || !(isAuthenticated$ | async)"
      >
        <!-- Attachment icon -->
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"
          ></path>
        </svg>
      </button>
      <button
        class="absolute right-4 top-1/2 -translate-y-1/2 bg-black text-white p-1.5 rounded-md hover:bg-gray-800 disabled:bg-gray-400"
        (click)="sendMessage()"
        [disabled]="!newMessage || isLoading || !(isAuthenticated$ | async)"
      >
        <!-- Send icon -->
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
          ></path>
        </svg>
      </button>
    </div>
    <p class="privacy-text text-center text-xs text-gray-400 mt-2">
      Your data is private and secure
    </p>
  </div>
</div>
